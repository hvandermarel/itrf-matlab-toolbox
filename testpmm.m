%% Test Plate Model Motion (PMM) functions PMMPAR and PMMVEL

% PMMPAR and PMMVEL need functions plh2xyz and xyz2neu from crsutil

addtoolbox('itrf')

% Define table with GSRM 2.1 NNR velocities from Unavco Plate Motion Calculator 

nomveltable = [ ... 
   1.000000  50.000000   17.42   16.97  ; ... 
   1.000000  51.000000   17.11   16.97  ; ...
   1.000000  52.000000   16.79   16.97  ; ...
   1.000000  53.000000   16.47   16.97  ; ...
   1.000000  54.000000   16.14   16.97  ; ... 
   1.000000  55.000000   15.81   16.97  ; ... 
   2.000000  50.000000   17.65   16.94  ; ... 
   2.000000  51.000000   17.34   16.94  ; ... 
   2.000000  52.000000   17.02   16.94  ; ... 
   2.000000  53.000000   16.71   16.94  ; ... 
   2.000000  54.000000   16.38   16.93  ; ... 
   2.000000  55.000000   16.05   16.93  ; ... 
   3.000000  50.000000   17.87   16.90  ; ... 
   3.000000  51.000000   17.57   16.90  ; ... 
   3.000000  52.000000   17.26   16.90  ; ... 
   3.000000  53.000000   16.94   16.89  ; ... 
   3.000000  54.000000   16.62   16.89  ; ... 
   3.000000  55.000000   16.29   16.89  ; ... 
   4.000000  50.000000   18.10   16.85  ; ... 
   4.000000  51.000000   17.80   16.85  ; ... 
   4.000000  52.000000   17.49   16.85  ; ... 
   4.000000  53.000000   17.17   16.85  ; ... 
   4.000000  54.000000   16.86   16.85  ; ... 
   4.000000  55.000000   16.53   16.85  ; ... 
   5.000000  50.000000   18.32   16.80  ; ... 
   5.000000  51.000000   18.02   16.80  ; ... 
   5.000000  52.000000   17.72   16.80  ; ... 
   5.000000  53.000000   17.41   16.80  ; ... 
   5.000000  54.000000   17.09   16.80  ; ... 
   5.000000  55.000000   16.77   16.80  ; ... 
   6.000000  50.000000   18.55   16.74  ; ... 
   6.000000  51.000000   18.25   16.74  ; ... 
   6.000000  52.000000   17.95   16.74  ; ... 
   6.000000  53.000000   17.64   16.74  ; ... 
   6.000000  54.000000   17.33   16.74  ; ... 
   6.000000  55.000000   17.01   16.74  ; ... 
   7.000000  50.000000   18.77   16.68  ; ... 
   7.000000  51.000000   18.48   16.68  ; ... 
   7.000000  52.000000   18.18   16.68  ; ... 
   7.000000  53.000000   17.87   16.68  ; ... 
   7.000000  54.000000   17.56   16.68  ; ... 
   7.000000  55.000000   17.25   16.68  ; ... 
   8.000000  50.000000   18.99   16.62  ; ... 
   8.000000  51.000000   18.70   16.61  ; ... 
   8.000000  52.000000   18.41   16.61  ; ... 
   8.000000  53.000000   18.11   16.61  ; ... 
   8.000000  54.000000   17.80   16.61  ; ... 
   8.000000  55.000000   17.49   16.61  ; ... 
   9.000000  50.000000   19.21   16.54  ; ... 
   9.000000  51.000000   18.93   16.54  ; ... 
   9.000000  52.000000   18.63   16.54  ; ... 
   9.000000  53.000000   18.34   16.54  ; ... 
   9.000000  54.000000   18.03   16.54  ; ... 
   9.000000  55.000000   17.72   16.54  ];

% PLH array with latitude, longitude and height [rad,rad,m] for PMMVEL

plh = [ nomveltable(:,2)*pi/180 nomveltable(:,1)*pi/180 zeros(size(nomveltable,1),1) ];

% Compute plate motion velocities [m/y -> mm/y]

vel = pmmvel('GSRM 2.1 NNR','EURA', plh)*1000;

% Compare with velocities from Unavco Plate Motion Calculator

diffvel = vel(:,1:2)-nomveltable(:,[4 3]);
diffvel(:,3) = vel(:,3);

fprintf('Difference in North, East and Up velocity [mm/y]:\n   Mean   %.4f  %.4f  %.4f\n   Std    %.4f  %.4f  %.4f\n', ...
    mean(diffvel),std(diffvel))



